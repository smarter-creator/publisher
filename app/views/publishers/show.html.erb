<div class="container-xl pt-3">

<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title"><%= @publisher&.title %></h5>
    <p class="card-text"><%= @publisher&.description %></p>
  </div>
</div>
<!-- Button to trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#eventModal">
  New Event
</button>

<!-- Modal -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventModalLabel">Create Event</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
     <div class="modal-body">
  <%= form_with model: @event, url: publisher_events_path(@publisher), local: true, class: "needs-validation" do |f| %>
    <div class="mb-3">
      <%= f.label :title, "Event Title", class: "form-label" %>
      <%= f.text_field :title, class: "form-control", required: true %>
    </div>

    <div class="mb-3">
      <%= f.label :start_datetime, "Start Date & Time", class: "form-label" %>
      <%= f.datetime_field :start_datetime, class: "form-control", required: true %>
    </div>

    <div class="mb-3">
      <%= f.label :end_datetime, "End Date & Time", class: "form-label" %>
      <%= f.datetime_field :end_datetime, class: "form-control", required: true %>
    </div>

    <div class="mb-3">
      <%= f.label :recurrence, "Recurrence", class: "form-label" %>
      <%= f.select :recurrence, [["None", nil], ["Daily", "daily"], ["Weekly", "weekly"], ["Monthly", "monthly"]], {}, class: "form-control" %>
    </div>

    <%= f.hidden_field :publisher_id, value: @publisher.id %>

    <div class="modal-footer">
      <%= f.submit "Save Event", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

    </div>
  </div>
</div>

<table class="table mt-4">
  <thead>
    <tr>
      <th scope="col">Event Name</th>
      <th scope="col">Start Date & Time</th>
      <th scope="col">End Date & Time</th>
      <th scope="col">Recurrence</th>
      <th scope="col">Publisher</th>
      <th scope="col">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.title %></td>
        <td><%= event.start_datetime.strftime("%Y-%m-%d %H:%M") %></td>
        <td><%= event.end_datetime.strftime("%Y-%m-%d %H:%M") %></td>
        <td><%= event.recurrence %></td>
        <td><%= @publisher.title %></td>
        <td class="d-flex" style="gap: 1rem;">        <%= link_to "Edit", edit_publisher_event_path(@publisher, event), class: "btn btn-warning btn-sm" %>

  <%= button_to "Delete", publisher_event_path(@publisher, event), 
        method: :delete, 
        data: { confirm: "Are you sure?" }, 
        class: "btn btn-danger btn-sm" %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>